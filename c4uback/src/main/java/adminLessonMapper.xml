<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.AdminLessonMapper">

<!--심사 승인-->
<update id="updateLesson" parameterType="java.lang.Integer">
	UPDATE lesson
	SET lesson_status = 0, 
	      lesson_create_date = SYSDATE,
	      lesson_end_date= SYSDATE+30
	WHERE lesson_id = #{lessonId} 
</update>

<!--심사 거절 -->
<insert id="insertPenaltyStatus" parameterType="LessonPenaltyStatus">
	INSERT INTO lesson_penalty_status(lessonps_id, lessonps_lesson_id, lessonps_evaluation_id, lessonps_date)
	VALUES(seq_lesson_penalty_status_id.NEXTVAL, #{lesson.lessonId}, #{lessonPenalty.lpId}, SYSDATE)
</insert>

<select id="adminSelectByPage">

SELECT l.lesson_id,l.lesson_name,s.student_name,l.lesson_create_date,
       lp.lp_content, lps.lessonps_date
FROM lesson l
LEFT JOIN lesson_penalty_status lps
     ON l.lesson_id = lps.lessonps_id
LEFT JOIN lesson_penalty lp 
     ON lps.lessonps_evaluation_id = lp.lp_id
LEFT JOIN student s
     ON l.lesson_teacher_id = s.student_id
WHERE s.student_id = #{student_id}  AND (l.lesson_name LIKE '%${word}%' OR s.student_name LIKE '%${word}%')
ORDER BY l.lesson_id ASC;

</select>
</mapper>