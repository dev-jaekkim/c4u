<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>메인페이지</title>
    <link rel ="stylesheet" href="maindraft1.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./js/hyeongdon.js"></script>
    <script>
        $(function(){
            let frontContextPath = "http://localhost:8888/c4ufront";
            let backContextPath = "http://localhost:8888/c4uback"; 

            $("header").load("user_header.html");
            $("footer").load("footer.html");
            loginstatus();
            $("body>div>section>article").empty();
            var cp = 1;
            var $btMoreObj = $("input.seemore"); //더보기 조건 관련해서 수정
            $btMoreObj.hide();

            $.ajax ({
                "method": "GET",
                "transformRequest": [
                    null
                ],
                "transformResponse": [
                    null
                ],
                "jsonpCallbackParam": "callback",
                "url": backContextPath+"/lesson/list",
                "headers": {
                    "Accept": "application/json, text/plain, */*"
                },
                "data": "",
                "timeout": {},
                success: function(responseObj){
                    console.log("응답성공");
                    //서버에서 전송해준 배열 객체로 저장                     
                    var startPageValue = 0;
                    var totalPageValue = 0;
                    // console.log(responseObj.length);
                    if(responseObj.status == 1) {
                        console.log(responseObj);
                        startPageValue = responseObj.pgb.startPage;
                        totalPageValue = responseObj.pgb.totalPage;
                        $(responseObj.pgb.list).each(function(index, element){
                            //article객체생성
                            var $articleObj = $('<article>');
                            var articleHtml = "<ul>";
                            articleHtml += '<li>';
                            articleHtml += "<img src='./images/th"+ element.lessonId +".jpg' alt='th" + element.lessonId +".jpg'>";
                            articleHtml += "</li>";
                            articleHtml += "<li><b>&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.lessonName;
                            articleHtml += "</b></li>";
                            articleHtml += "<li>&nbsp;&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.lessonTotalFee;
                            articleHtml += "</li>";
                            articleHtml += "<li>&nbsp;&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.targetPercent + "%";
                            articleHtml += "</li>";
                            articleHtml += "<li>&nbsp;&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.diffDays + "일 남음";
                            articleHtml += "</li>";
                            articleHtml += "</ul>";

                            $articleObj.attr("class", element.lessonId);
                            $articleObj.attr("onclick", "location.href='classdetail.html?lessonId=" + element.lessonId+"'" );
                            $articleObj.html(articleHtml);

                            $btMoreObj.before($articleObj);
                        });
                    }
                    if(totalPageValue > cp){
                        $btMoreObj.show();
                    }
                    $("section.classname1").show();
                },
                error: function(jqXHR){
                        alert("오류 내용: "+jqXHR.status);
                }
            });

            $("section.classname1").on('click','input[class="seemore"]',function(event){
                $btMoreObj.hide();
                cp += 1;
                $.ajax ({
                "method": "GET",
                "transformRequest": [
                    null
                ],
                "transformResponse": [
                    null
                ],
                "jsonpCallbackParam": "callback",
                "url": backContextPath+"/lesson/list/"+cp,
                "headers": {
                    "Accept": "application/json, text/plain, */*"
                },
                "data": "",
                "timeout": {},
                success: function(responseObj){
                    
                    //서버에서 전송해준 배열 객체로 저장                     
                    var startPageValue = 0;
                    var totalPageValue = 0;
                    if(responseObj.status == undefined) {
                        console.log(responseObj);
                        startPageValue = responseObj.pgb.startPage;
                        totalPageValue = responseObj.pgb.totalPage;

                        $(responseObj.pgb.list).each(function(index, element){
                            //article객체생성
                            var $articleObj = $('<article>');
                            var articleHtml = "<ul>";
                            articleHtml += '<li>';
                            articleHtml += "<img src='./images/th"+ element.lessonId +".jpg' alt='th" + element.lessonId +".jpg'>";
                            articleHtml += "</li>";
                            articleHtml += "<li><b>&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.lessonName;
                            articleHtml += "</b></li>";
                            articleHtml += "<li>&nbsp;&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.lessonTotalFee;
                            articleHtml += "</li>";
                            articleHtml += "<li>&nbsp;&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.targetPercent + "%";
                            articleHtml += "</li>";
                            articleHtml += "<li>&nbsp;&nbsp;&nbsp;&nbsp;";
                            articleHtml += element.diffDays + "일 남음";
                            articleHtml += "</li>";
                            articleHtml += "</ul>";
                            $articleObj.attr("class", element.lessonId);
                            $articleObj.attr("onclick", "location.href='classdetail.html?lessonId=" + element.lessonId+"'" );
                            $articleObj.html(articleHtml);

                            $btMoreObj.before($articleObj);
                        });
                    }

                    if(totalPageValue > cp){
                        $btMoreObj.show();
                    }
                    $("section.classname1").show();
                },
                error: function(jqXHR){
                    alert("강좌가 없습니다.");
                }
            });
        });
    });
    </script>
</head>
<body>
    <div class="container">
        <header></header>
        <section class = "thebiggestbox">
            <article class = "pic"></article>
        </section>
        
        <section class="classname1">
            <input type="button" class="seemore" value="더보기" style="display:none;">
        </section>

        <div class="bg">
            <div class="modal"></div>
        </div>
        <footer></footer>
    </div>
</body>
</html>