<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>강좌 심사</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./js/hyeongdon.js"></script>
    <style>
         @import url('https://fonts.googleapis.com/css?family=Raleway&display=swap');
         * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            list-style: none;
            text-decoration: none;
            font-family: 'Raleway', sans-serif;
            color: #222;
            /* line-height: 1.5em; */
            font-weight: 300;
        }
        div.search{
            margin-left: 35%;
       }
       .admin_evaluation_list span:hover{
            font-weight: 800;
            color: rgb(255, 87, 87);
       }
       .admin_evaluation_list div.page_group{
            margin-left: 35%;
            margin-top: 20px;
       }
       .admin_evaluation_list>div.admin_lesson_title{
            margin-left: 50px;
            margin-top: 30px;
            margin-bottom: 10px;
       }
       .admin_evaluation_list>hr{
            opacity: 35%;
            width: 1050px;
            margin-left: 50px;
       }
       .admin_evaluation_list .lesson_list{
            border: 1px solid;
            border-collapse: collapse;
            margin-left: 50px;
            margin-top: 20px; 
       }

       .admin_evaluation_list th,td{
        border: 1px solid;
       }
       
       .admin_evaluation_list th{
            text-align: center;
            background-color: lightgrey;
            font-weight: 800;
       }
       
      
       .admin_evaluation_list .lesson_penalty_content{
            padding-left: 10px;
            padding-right: 10px;
            width: 500px;
       }
       .admin_evaluation_list .lesson_teacher_name{
            padding-left: 10px;
            padding-right: 10px;
            width: 100px;
            text-align: center;
       }
       .admin_evaluation_list .lesson_name{
            padding-left: 10px;
            padding-right: 10px;
            width: 300px;
            text-align: center;
       }
       .admin_evaluation_list .lesson_id{
        text-align: center;
       }
       .admin_evaluation_list .lesson_create_date{
        text-align: center;
        padding-left: 10px;
        padding-right: 10px;
        width: 120px;
       }
       .admin_evaluation_list .lesson_ps{
            width: 70px;
            padding-top: 5px;
            padding-bottom: 5px;
            font-weight: 800;
            text-align: center;
       }
       .admin_evaluation_list div.page_group\,.copy{
       		margin-left: 35%;    
       		margin-bottom: 10px;
       		margin-top: 10px;   
       }       
  
    </style>
    <script>
         let frontContextPath = "http://localhost:8888/c4ufront";
         let backContextPath = "http://localhost:8888/c4uback";
         
         $(document).on("click", ".lesson_ps",function(e){
        	 var lessonId_val = $(e.target).siblings("td.lesson_id").html();
             console.log(lessonId_val);
             location.href = "./admin_evaluation_detail.html";
             sessionStorage.setItem("lessonId", lessonId_val);
             
         });
         	
         $(function () {
        	if(adminLoginStatus()==-9){
        		//어드민로그인실패
        		location.href=backContextPath+"/myLogin";
        		return;
        	}      	
        	//console.log("front 쿠키 정보 확인");
            $(".header").load("admin_header.html");

            
            function showList(responseObj){
                console.log(" admin_evaluation_list showList() 시작");
                console.log(responseObj);
                console.log("-----------");

	            //테이블객체
	            var $tableObj =$("section>div.admin_evaluation_list>table.lesson_list");

                $("section>div.admin_evaluation_list>table.lesson_list tr.copy").remove();
                //console.log("삭제");
                
                //원본행객체
                var $trOriginObj = $("section>div.admin_evaluation_list>table tr.origin");
                $trOriginObj.show(); //원본행객체 보여주기
               
                if(responseObj.status == -1){
                    alert(responseObj.msg);
                    return false;
                }else{
                    $(responseObj.pgb.list).each(function(index, element){
                        console.log("---------");
                       // console.log(element);
                       
                        var $trCopyObj = $trOriginObj.clone(); //원본행객체의 복제본만들기
                        $trCopyObj.addClass("copy"); //복제본행의 클래스속성으로 copy설정
                        $trCopyObj.removeClass("origin"); //복제본행의 클래스속성중 origin제거
                        
                         //복제본행의 내용 채우기 : lesson_id
                         $trCopyObj.find("td.lesson_id").html(element.lesson.lessonId);
                         console.log("강좌번호"+element.lesson.lessonId);
                       

                       //복제본행의 내용 채우기 : rnum
                        $trCopyObj.find("td.lesson_rnum").html(element.lesson.rnum);
                       //console.log("강좌번호"+element.lessonId);
                       
                        //복제본행의 내용 채우기 : 심사강좌제목
                        $trCopyObj.find("td.lesson_name").html(element.lesson.lessonName);
                       // console.log("강좌제목"+element.lessonName);

                        //복제본행의 내용 채우기 : 강사이름
                        $trCopyObj.find("td.student_name").html(element.lesson.teacher.studentName);
                        //console.log("강사이름"+element.studentName);
                        
                        //복제본행의 내용 채우기 : 개설 날짜
                        $trCopyObj.find("td.lesson_create_date").html(element.lesson.lessonCreate);
                        //console.log("element.lessonCreate");

                        //복제본행의 내용 채우기 : 심사내용
                        console.log(element.lessonPenalty.lpContent);
                        console.log("---------");
                        $trCopyObj.find("td.lp_content").html(element.lessonPenalty.lpContent);
                        //console.log("element.lpContent");

                        //복제본의 내용 채우기: 심사날짜
                        $trCopyObj.find("td.lessonps_date").html(element.lessonPsDate);
                        //console.log("element.lessonPsDate");

                        //테이블객체의 자식객체로 복제본행을 추가

                       // console.log( "element.lessonName=" + element.lessonName + ", $trCopyObj.find(td.lesson_name)=" +$trCopyObj.find("td.lesson_name"));
                        $tableObj.append($trCopyObj);
                       
                    }); //each
                    
                    $trOriginObj.hide();
                }
            };

            function pageGroup(responseObj){
                //console.log(responseObj);
              
                var totalCnt_val = responseObj.pgb.totalCnt;
                var cnt_per_page_val = responseObj.pgb.cnt_per_page;
                var cnt_per_page_group_val = responseObj.pgb.cnt_per_page_group;
                var startPage_val = responseObj.pgb.startPage;
                var endPage_val = responseObj.pgb.endPage;
                var totalPage_val = responseObj.pgb.totalPage;
                //var list_size_val = responseObj.pgb.list.length;

                // console.log("totalCnt_val :"+totalCnt_val);
                // console.log("cnt_per_page_val: "+cnt_per_page_val);
                // console.log("cnt_per_page_group_val : "+cnt_per_page_group_val);
                // console.log("startPage_val: "+startPage_val);
                // console.log("endPage_val : "+ endPage_val);
                // console.log("totalPage_val : "+ totalPage_val);
                // console.log("list_size_val: "+ list_size_val);

                //divPageList객체(page number)
                var  $divPageListObj = $("section>div.admin_evaluation_list>div.page_list");

                $("section>div.admin_evaluation_list>div.page_list div.copy").remove();
                $("section>admin.admin_evaluation_list>div.page_list span.copy").remove();

                //원본객체
                var $pageGroupOriginObj = $("section>div.admin_evaluation_list>div.page_list>div.origin");
                $pageGroupOriginObj.show();

                if(responseObj.status == -1){
                    alert(responseObj.msg);
                    return false;
                }else{

                var $pageGroupCopyObj = $pageGroupOriginObj.clone(); //원본행겍체의 복제본 선언
                $pageGroupCopyObj.addClass("copy"); //복제본행의 클래스속성으로 copy설정
                $pageGroupCopyObj.removeClass("origin"); //복제본행의 클래스속성중 origin제거
                //$pageGroupObj.addClass("copy"); //복제본행의 클래스속성으로 copy설정
                //$pageGroupObj.removeClass("origin"); //복제본행의 클래스속성중 origin제거

                var $prevArrowObj  = $pageGroupCopyObj.find("span.page_btprev"); //이전버튼 
                var $nextArrowObj = $pageGroupCopyObj.find("span.page_btnext");  //다음버튼

                //이전 화살표 show
                if(startPage_val > cnt_per_page_group_val){
                    $nextArrowObj.show();
                }

                //다음 화살표 show 
                if (endPage_val < totalPage_val){
                    $nextArrowObj.show();
                }

                //page number 추가
                for(var i = startPage_val; i<=endPage_val; i++){
                   
                            var $pageNumberObj = $('<span class="page_number, copy">');
                            $pageNumberObj.html("&nbsp;"+"&nbsp;"+"&nbsp;"+i);
                            $nextArrowObj.before($pageNumberObj);
                            $pageNumberObj.show();

                            if(totalCnt_val < cnt_per_page_val){
                                break;
                            }
                    }; 
                 
                    $divPageListObj.append($pageGroupCopyObj);
            }

            $pageGroupOriginObj.hide();

        };
            //alert("ajax 실행 전");
            $.ajax(
                {
                "url": backContextPath+"/admin/Evaluationlist",
                "method": "GET",
                "transformRequest": [
                null
                ],
                "transformResponse": [
                null
                ],
                "jsonpCallbackParam": "callback",
                "headers": {
                "Accept": "application/json, text/plain, */*"
                },
                "data": "",
                "timeout": {},
                success: function(responseObj){
                    showList(responseObj);
                    pageGroup(responseObj);                   
                },
                error:function(jqXHR){
                    alert(jqXHR.status);
                }
            });
            //alert("ajax 실행 후");
            //검색버튼 클릭 시작
            $("section>div.admin_evaluation_list>form input[type=button]").click(function(){
                $.ajax({
                        url: backContextPath+"/admin/Evaluationlist/1/"+$("section>div.admin_evaluation_list>form input[name=word]").val(),      
                        "method": "GET",
                        "transformRequest": [
                            null
                        ],
                        "transformResponse": [
                            null
                        ],
                        "jsonpCallbackParam": "callback",
                        "headers": {
                            "Accept": "application/json, text/plain, */*"
                        },
                        "data": "",
                        "timeout": {},
                        success:function(responseObj){
                            showList(responseObj);
                            pageGroup(responseObj);
                           // console.log("검색버튼 요청" + responseObj);
                        },
                        error:function(jqXHR){
                                alert("검색결과가 없습니다.");
                            }     
                        });
                        return false;    
        });
          
     
        //검색버튼 클릭 끝

        //페이징 숫자 버튼 클릭 시작
        $("body>section>div>div.page_list").on("click", "span", function(event){
            var str_page_number = null;
                if($(event.target).html() == $("span.page_btnext").html()){
                    var bt_next_arrow_val = $(event.target).prev().html();
                    // console.log("다음 화살표 값 자르기전: "+bt_next_arrow_val);
                    str_page_number = bt_next_arrow_val.split("&nbsp;&nbsp;&nbsp;");
                    str_page_number[1] = Number(str_page_number[1]) + 1;
                    // console.log("다음화살표"+str_page_number[1]);
                }else if($(event.target).html() == $("span.page_btprev").html()){
                    var bt_prev_arrow_val = $(event.target).next().html();
                    // console.log("이전 화살표 값 자르기전: "+bt_prev_arrow_val);
                    str_page_number = bt_prev_arrow_val.split("&nbsp;&nbsp;&nbsp;");
                    str_page_number[1] = Number(str_page_number[1]) - 1;
                    // console.log("이전화살표"+str_page_number[1]);
                }else{
                    var bt_page_number_val = $(event.target).html().trim();
                    str_page_number = bt_page_number_val.split("&nbsp;&nbsp;&nbsp;");
                    // console.log("숫자도 찍힘");
                }
                //console.log("현재 화살표 값" + str_page_number[1]);

                var word = $("section>div.admin_evaluation_list>form input[name=word]").val(); 
                var url = backContextPath+"/admin/Evaluationlist/"+str_page_number[1];
                if(word.trim() != ''){
                    url += '/' + word;
                }
                $.ajax({
                        url: url,
                        "method": "GET",
                        "transformRequest": [
                            null
                        ],
                        "transformResponse": [
                            null
                        ],
                        "jsonpCallbackParam": "callback",
                        "headers": {
                            "Accept": "application/json, text/plain, */*"
                        },
                        "data": "",
                        "timeout": {},
                        success: function(responseObj){
                            showList(responseObj);
                            pageGroup(responseObj);
                        },
                        error: function(jqXHR){
                            // alert("jqXHR status :"+ jqXHR.status);
                            alert("검색 결과가 없습니다.");
                        }
                       
        });
        return false;
    });
    //페이징 숫자 버튼 끝
});
    </script>
</head>
<body>
    <div class="header"></div>
    <section>
        <div class="admin_evaluation_list">
            <div class="admin_lesson_title">
                <h1>강좌 심사</h1>
            </div>
            <hr>
            <table class="lesson_list">
                <thead class="lesson_head">
                    <tr class="lesson_head_tr">
                        <th>번호</th>
                        <th>강좌</th>
                        <th>선생님</th>
                        <th>개설 날짜</th>
                        <th>거절 날짜</th>
                        <th>거절사유</th>
                        <th>심사하기</th>
                    </tr>
                </thead>
                <tbody class="lesson_list">               
                    <tr class="lesson_body_tr origin" style="display: none;">
                        <td class="lesson_id" style="display: none;">1</td>
                        <td class="lesson_rnum">1</td>
                        <td class="lesson_name">꽃 구입충동 생기는 러블릭 꽃병</td>
                        <td class="student_name">Park Geon-WOO</td>
                        <td class="lesson_create_date">2021-01-01</td>
                        <td class="lp_content">썸네일 불량</td>
                        <td class="lessonps_date">2021-04-29</td>
                        <td class="lesson_ps">심사</td>
                    </tr>
                </tbody>
            </table>
 <input type="hidden" class="lessonId">
        <div class="page_list">
            <div class="page_group, origin" style="display: none;">
                <span class="page_btprev" style="display: none;">&#9664;</span> 
                <span class="page_btnext" style="display: none;">&#9654;</span> 
            </div>
        </div>
    <form>
            <div class="search">
                <input type="hidden" name="lesson_id">
                <input type="hidden" name="currentPage">
                <input type="search" name="word" placeholder="검색" class="inputsearch">
                <input type="button" value="검색" class="btsearch"> 
            </div>
    </form>
        </div>
    </section>
    <footer><div class="footer"></div></footer>
</body>
</html>